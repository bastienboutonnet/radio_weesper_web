{{ define "title" }}{{ .Site.Title }}{{ end }} {{ define "main" }}
<main class="homepage">
  <script src="/js/live-marquee.js"></script>


  <!-- Player + Now Playing or Schedule -->
  {{ if .Site.Params.radio_online }} {{ partial "player-online.html" . }} {{
  else }} {{ partial "player-offline.html" . }} {{ end }}

  <!-- Recent shows -->
  <section class="recent-section container">
    <h2 class="recent-heading page-title">Latest Shows</h2>
    <div class="recent-posts">
      {{ $now := now }}
      {{ $pastShows := where (where .Site.RegularPages "Section" "post") "Date" "<" $now }}
      {{ range first 6 $pastShows }}
        {{ $p := . }}
        {{ $showtime := .Params.showtime }}
        {{ $hasResident := isset .Params "is_resident" }}
        {{ $isResident := cond $hasResident .Params.is_resident true }}
        {{ $artists := .Params.artists }}
        {{ if not $artists }}{{ $artists = slice (or .Params.show_name .Title) }}{{ end }}
        {{ $artistsStr := partial "format-artists.html" (dict "artists" $artists) }}
        {{ $showName := .Params.show_name }}
        {{ $title := (or $showName .Title) }}
        {{ $displayTitle := cond (and (not $isResident) (not $showName)) $artistsStr $title }}
        {{ if or (and $showtime (ne $showtime "")) (and $displayTitle (ne $displayTitle "")) }}
        <article class="recent-post">
          {{ with .Params.image }}
          <img
            class="recent-post-img"
            src="{{ . | relURL }}"
            alt="{{ $displayTitle }}"
          />
          {{ end }}
          <div class="recent-post-content">
            <div class="upcoming-meta">
              <span class="upcoming-pill upcoming-pill-date">{{ .Date.Format "Mon, 02 Jan" }}</span>
            </div>
            <h3 class="recent-title">{{ $displayTitle }}</h3>
            {{ if $isResident }}
              <p class="recent-artists">with {{ $artistsStr }}</p>
            {{ else }}
              <p class="recent-artists">Guestmix</p>
            {{ end }}
            <div class="post-tags">
              {{ with .Params.tags }} {{ range first 4 . }}<span class="post-tag"
                >{{ . }}</span
              >{{ end }} {{ end }}
            </div>
          </div>
          <a class="card-link" href="{{ .RelPermalink }}" aria-label="Open {{ $displayTitle }}"></a>
        </article>
        {{ end }}
      {{ end }}
    </div>
  </section>
</main>
{{ end }}
